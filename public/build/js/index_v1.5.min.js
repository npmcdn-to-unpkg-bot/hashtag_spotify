"use strict";var n=n||{};n.Dal=function(){},n.Dal.prototype.getCardData=function(t,e,i){var n=new this.HttpRequest(e,i,"POST");n.getData(function(e,i){return i?t(null,i):void t(e)}.bind(this))},n.Dal.prototype.HttpRequest=function(t,e,i){this.request=new XMLHttpRequest(null),this.request.open(i,t,!0),this.request.timeout=5750,this.request.send(JSON.stringify(e))},n.Dal.prototype.HttpRequest.prototype.errors={timeout:"server might be down.",unknown:"check your internet connection."},n.Dal.prototype.HttpRequest.prototype.getData=function(t){this.request.addEventListener("load",function(e){t(JSON.parse(this.response))}),this.request.addEventListener("error",function(){return t(null,new Error(this.errors.unknown))}.bind(this)),this.request.addEventListener("timeout",function(){return t(null,new Error(this.errors.timeout))}.bind(this))},n.MessageView=function(){},n.MessageView.prototype.connectionErrorView=function(t){this.ConnectionErrorTempalte=this.connectionErrorTempalte(),this.ConnectionErrorView=new this.ConnectionErrorTempalte({replace:!1,data:{show:!0},methods:{reloadClick:function(){t(),this.$data.show?this.$data.show=!1:this.$data.show=!0,this.$destroy(this)}},attached:function(){this.$data.show=!0}}),this.mountConnectionErrorView("#refreshHolder")},n.MessageView.prototype.connectionErrorTempalte=function(){return Vue.extend({template:'<div v-cloak v-if="show" class="offline-card-square mdl-card mdl-shadow--2dp refreshIconWrap"><div class="mdl-card__title mdl-card--expand"><h2 class="mdl-card__title-text">Server is down</h2></div><div class="mdl-card__supporting-text">It seems as the server is offline. <br/>Wait a minute or try reloading.</div><div class="mdl-card__actions mdl-card--border"><a v-on:click="reloadClick" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">Reload</a></div></div>'})},n.MessageView.prototype.mountConnectionErrorView=function(t){this.ConnectionErrorView.$mount().$appendTo(t)},n.MessageView.prototype.begnninersGuidView=function(t){this.BegnninersGuidView=new Vue({el:"#begnninersGuidHolder",data:{show:!0},methods:{startApp:function(){this.$data.show=!1,t()}},attached:function(){}})},n.MessageView.prototype.noMorePagesView=function(){this.noMorePagesTemplate=this.noMorePagesTemplate(),this.NoMorePagesView=new this.noMorePagesTemplate({replace:!1,data:{show:!0},methods:{},attached:function(){this.$data.show=!0}}),this.mountNoMorePagesView("#pageEndHolder")},n.MessageView.prototype.noMorePagesTemplate=function(){return Vue.extend({template:'<div v-cloak v-if="show" class="offline-card-square mdl-card mdl-shadow--2dp noMorePagesHolder"><div class="mdl-card__title mdl-card--expand"><h2 class="mdl-card__title-text">No more cards</h2></div><div class="mdl-card__supporting-text">Check back in a little while.</div></div>'})},n.MessageView.prototype.mountNoMorePagesView=function(t){this.NoMorePagesView.$mount().$appendTo(t)},n.LocalStorageListDal=function(){this.storageLocation="menuItems",this.items=[]},n.LocalStorageListDal.prototype.saveList=function(t){return localStorage.setItem(this.storageLocation,JSON.stringify(t)),this.items=t,this},n.LocalStorageListDal.prototype.loadItems=function(){var t=JSON.parse(localStorage.getItem(this.storageLocation));return Array.isArray(t)&&(this.items=t),this},n.LocalStorageListDal.prototype.removeAllItems=function(){return localStorage.setItem(this.storageLocation,null),this.items=[],this},n.LocalStorageListDal.prototype.toValue=function(){return this.items},n.Menu=function(t){this.localStorageListDal=new n.LocalStorageListDal;var e=this.localStorageListDal.loadItems().toValue();this.listView=this.listView(this,e)},n.Menu.prototype.listView=function(t,e){return new Vue({el:"#list",data:{show:!1,showOpenMenu:!0,items:e},methods:{toggleList:function(){this.$data.show?(this.$data.show=!1,this.$data.showOpenMenu=!0):(this.$data.show=!0,this.$data.showOpenMenu=!1)},removeItem:function(e){this.items.splice(e,1),console.log(e),t.localStorageListDal.saveList(this.items)},addItemToList:function(e){try{this.$data.show||(this.$els.listBage.dataset.badge=this.items.length+1)}catch(i){}this.items.push(e),t.localStorageListDal.saveList(this.items)},buildUrl:function(){var t="http://188.166.26.125:3334/login?list=",e=[];this.$data.items.forEach(function(t){e.push(t.id)}.bind(this)),this.removeAllItemsInList(),t+=JSON.stringify(e);window.open(t,"playlist create","width=400, height=400")},removeAllItemsInList:function(){this.$data.items=[],t.localStorageListDal.removeAllItems()}},attached:function(){Array.isArray(e)&&(this.$els.listBage.dataset.badge=this.items.length)},transitions:{expand:{afterLeave:function(t){try{this.$els.listBage.dataset.badge=this.items.length}catch(e){}}}}})},n.Card=function(t,e,i,n,a){this.cardData=e,this.isFirstCard=a,this.cardBehind=t,this.menu=i;var o=this.cardTemplate(this.cardData);this.cardView=this.cardView(o,this,n)},n.Card.prototype.cardView=function(t,e,i){return new t({data:{playMusic:!0},methods:{pausePlayClick:function(){this.$data.playMusic?(this.pauseAudio(),this.$data.playMusic=!1):(this.playAudio(),this.$data.playMusic=!0)},changeVolume:function(t){1>=t&&t>=0&&(this.$els.audioPlayer.volume=t)},pauseAudio:function(){this.$els.pausePlayIconHolder.textContent="play_circle_filled",this.$els.audioPlayer.pause()},playAudio:function(){this.$els.pausePlayIconHolder.textContent="pause_circle_filled",this.$els.audioPlayer.play()}},attached:function(){this.swipe=new n.Swipe(this.$el),this.swipe.onThrowout(function(t){e.cardBehind?e.cardBehind.cardView.playAudio():i(!0),1===t.throwDirection&&e.menu.listView.addItemToList(e.cardData),this.$destroy(this)}.bind(this)),this.swipe.onThrowin(function(t){this.changeVolume(1)}.bind(this)),this.swipe.onDragMove(function(t){this.changeVolume(1-t.throwOutConfidence)}.bind(this)),e.isFirstCard&&this.playAudio()}})},n.Card.prototype.cardTemplate=function(t,e){return Vue.extend({template:'<li class="diamonds"><div class="music-card-square mdl-card mdl-shadow--2dp"><div class="mdl-card__title mdl-card--expand"><img v-el:head-img src="'+t.albumArt.url+'"></div><div class="mdl-card__supporting-text">Artist: '+t.artistName+"<br/>Album: "+t.albumName+"<br/>Song: "+t.songName+'<br/><a href="'+t.externalUrl+'" target="_blank">Spotify Url</a></div><div class=""><audio class="audioPlayer" v-el:audio-player controls><source src="'+t.preview_url+'" type="audio/mpeg"></audio><i v-on:click="pausePlayClick" v-el:pause-play-icon-holder class="material-icons playPauseBtn">play_circle_filled</i></div></div></li>'})},n.Card.prototype.mountCard=function(t){this.cardView.$mount().$appendTo(t)},n.Swipe=function(t){this.stack=gajus.Swing.Stack(),this.card=this.stack.createCard(t)},n.Swipe.prototype.onThrowout=function(t){this.stack.on("throwout",function(e){t(e)})},n.Swipe.prototype.onThrowin=function(t){this.stack.on("throwin",function(e){t(e)})},n.Swipe.prototype.throwOut=function(t){this.card.throwOut(t,0)},n.Swipe.prototype.onDragStart=function(t){this.stack.on("dragstart",function(e){t(e)})},n.Swipe.prototype.onDragMove=function(t){this.stack.on("dragmove",function(e){t(e)})},n.Swipe.prototype.onDragEnd=function(t){this.stack.on("dragend",function(e){t(e)})},n.init=function(t,e){e=e||{getTracks:{page:0}};var i=new n.Menu,a=new n.Dal,o=new n.MessageView;o.begnninersGuidView(function(){n.makeNewCards(a,i,o,e)})},n.makeNewCards=function(t,e,i,a){function o(){return null===r.pagenation.nextPage.getTracks.page?void i.noMorePagesView():void n.makeNewCards(t,e,i,r.pagenation.nextPage)}function s(){n.makeNewCards(t,e,i,a)}var r;t.getCardData(function(t,a){if(a)return void i.connectionErrorView(s);r=t;for(var l=0;l<t.tracks.length;l++){var d=new n.Card(d,t.tracks[l],e,o,l+1===t.tracks.length?!0:!1);d.mountCard(".stack")}},"http://188.166.26.125:3334/",a)},window.onload=n.init;
